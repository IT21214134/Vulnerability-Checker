import React, { useState, useEffect } from "react";
import { useParams, Link } from "react-router-dom";
import {
  MDBNavbar,
  MDBNavbarNav,
  MDBNavbarItem,
  MDBNavbarLink,
  MDBNavbarToggler,
  MDBContainer,
  MDBIcon,
  MDBCollapse,
} from "mdb-react-ui-kit";
import { FontAwesomeIcon } from "@fortawesome/react-fontawesome";
import {
  faCircleNotch,
  faHome,
  faUserCircle,
  faUserFriends,
} from "@fortawesome/free-solid-svg-icons";
import HandshakeIcon from "@mui/icons-material/Handshake";
import { Dropdown } from "react-bootstrap"; // Import react-bootstrap Dropdown
import axios from "axios";

export default function Header() {
  const [showBasic, setShowBasic] = useState(true);
  const { id } = useParams();
  const [userdata, setUserdata] = useState({});

  const handleLogout = () => {
    window.open("http://localhost:9000/logout", "_self");
  };

  const getUser = async () => {
    try {
      const response = await axios.get("http://localhost:9000/login/sucess", {
        withCredentials: true,
      });
      setUserdata(response.data.user);
    } catch (error) {
      console.log("error", error);
    }
  };

  useEffect(() => {
    getUser();
  }, []);

  return (
    <div style={{ display: "flex", alignItems: "center" }}>
      <img
        style={{ marginLeft: "30px" }}
        src="https://th.bing.com/th/id/R.7ec8db4c8cd5e24316aa7df8e861ab17?rik=NzmVFzZV%2fqRVhA&pid=ImgRaw&r=0"
        width={"10%"}
      />
      <h3
        style={{
          fontFamily: "Rockwell",
          marginTop: "-5px",
          marginLeft: "20px",
        }}
      >
        Ceylon Travel <br />
        <h6
          style={{
            fontFamily: "Brush Script MT",
            marginLeft: "10px",
            fontSize: "18px",
          }}
        >
          When You Need To Be Sure
        </h6>
      </h3>
      <MDBNavbar
        expand="lg"
        style={{
          backgroundColor: "#333",
          marginTop: "-30px",
          paddingTop: "20px",
          paddingBottom: "16px",
          marginLeft: "220px",
        }}
      >
        <style>
          {`
    .navbar-angle::before {
      content: "";
      position: absolute;
      top: 0;
      left: -20px;
      width: 0;
      height: 0;
      border-top: 59px solid transparent;
      border-right: 20px solid #333;
    }
    `}
        </style>
        <div className="navbar-angle"></div>
        <MDBContainer fluid>
          <MDBNavbarToggler
            onClick={() => setShowBasic(!showBasic)}
            aria-controls="navbarExample01"
            aria-expanded="false"
            aria-label="Toggle navigation"
          >
            <MDBIcon icon="bars" fas />
          </MDBNavbarToggler>
          <MDBCollapse show={showBasic} navbar>
            <MDBNavbarNav right className="mb-2 mb-lg-0">
              <MDBNavbarItem active>
                <Link to={`/user/post/add/${id}`}>
                  <MDBNavbarLink
                    aria-current="page"
                    href="#"
                    style={{
                      color: "white",
                      marginLeft: "60px",
                      fontSize: "20px",
                      fontFamily: "Trebuchet MS",
                    }}
                  >
                    <FontAwesomeIcon icon={faHome} /> Home
                  </MDBNavbarLink>
                </Link>
              </MDBNavbarItem>
              <MDBNavbarItem>
                <Link to={`/home`}>
                  <MDBNavbarLink
                    href="#"
                    style={{
                      color: "white",
                      marginLeft: "60px",
                      fontSize: "17px",
                      fontFamily: "Trebuchet MS",
                    }}
                  >
                    <FontAwesomeIcon icon={faCircleNotch} /> Trip Plans
                  </MDBNavbarLink>
                </Link>
              </MDBNavbarItem>
              <MDBNavbarItem>
                <Link to={`/signup`}>
                  <MDBNavbarLink
                    href="#"
                    style={{
                      color: "white",
                      marginLeft: "60px",
                      fontSize: "17px",
                      fontFamily: "Trebuchet MS",
                    }}
                  >
                    <HandshakeIcon /> Partner with US
                  </MDBNavbarLink>
                </Link>
              </MDBNavbarItem>
              <MDBNavbarItem>
                <Link to={`/user/profile/${id}`}>
                  <MDBNavbarLink
                    href="#"
                    style={{
                      color: "white",
                      marginLeft: "60px",
                      fontSize: "17px",
                      fontFamily: "Trebuchet MS",
                    }}
                  >
                    <FontAwesomeIcon icon={faUserFriends} /> My Profile
                  </MDBNavbarLink>
                </Link>
              </MDBNavbarItem>
              <MDBNavbarItem>
                <Link to={`/AllBlogs/${id}`}>
                  <MDBNavbarLink
                    href="#"
                    style={{
                      color: "white",
                      marginLeft: "60px",
                      fontSize: "17px",
                      fontFamily: "Trebuchet MS",
                    }}
                  >
                    <FontAwesomeIcon icon={faUserFriends} />
                    View Blogs
                  </MDBNavbarLink>
                </Link>
              </MDBNavbarItem>
              {Object.keys(userdata).length === 0 ? (
                <MDBNavbarItem>
                  <Link to={`/`}>
                    <MDBNavbarLink
                      href="#"
                      style={{
                        color: "white",
                        marginLeft: "60px",
                        fontSize: "17px",
                        fontFamily: "Trebuchet MS",
                      }}
                    >
                      <FontAwesomeIcon icon={faUserFriends} />
                      Log out
                    </MDBNavbarLink>
                  </Link>
                </MDBNavbarItem>
              ) : (
                <>
                  <div
                    style={{
                      display: "flex",
                      alignItems: "center",
                      marginLeft: "auto",
                    }}
                  >
                    {userdata && (
                      <Dropdown>
                        <Dropdown.Toggle
                          variant="light"
                          id="dropdown-basic"
                          style={{
                            backgroundColor: "#4e5450",
                            border: "none",
                            boxShadow: "none",
                            display: "flex",
                            alignItems: "center",
                          }}
                        >
                          <img
                            src={userdata.image}
                            alt="Profile"
                            style={{
                              width: "40px",
                              height: "40px",
                              borderRadius: "50%",
                              objectFit: "cover",
                              marginRight: "8px",
                            }}
                          />
                        </Dropdown.Toggle>

                        <Dropdown.Menu>
                          <Dropdown.ItemText>
                            <strong>{userdata.displayName}</strong>
                          </Dropdown.ItemText>
                          <Dropdown.Divider />
                          <Dropdown.Item onClick={handleLogout}>
                            Logout
                          </Dropdown.Item>
                        </Dropdown.Menu>
                      </Dropdown>
                    )}
                  </div>
                </>
              )}
            </MDBNavbarNav>
          </MDBCollapse>
        </MDBContainer>
      </MDBNavbar>
    </div>
  );
}
